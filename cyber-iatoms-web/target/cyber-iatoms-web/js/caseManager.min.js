var editIndex=undefined;var editRows=undefined;var title=undefined;var type=undefined;var viewDlg=undefined;var viewDlgShow=undefined;var saveParams;var mailgroupList=null;var isSign=false;var signCaseCategory=undefined;var signCaseStatus=undefined;function openMailAction(group,name,actionId,datagridId){if($("#mailShowFlag").val()!="Y"){$("#dlgMail").css("display","");$("#dlgMail").dialog({title:"案件通知設定",width:760,height:360,closed:true,resizable:true,modal:true,buttons:[{id:"sure_btn",text:"確定",width:90,},{id:"cancel_btn",text:"取消",width:90,}],create:function(){$(this).closest(".ui-dialog").find(".ui-button:first").addClass("c6");$(this).closest(".ui-dialog").find(".ui-button").eq(1).addClass("c6")}});$("#sure_btn").bind("click",function(){saveEmail(name)});$("#cancel_btn").bind("click",function(){$("#dlgMail").dialog("close")});$("#remindStart").datetimebox({validType:"dateTime",missingMessage:"請輸入提醒時間起",showSeconds:false});$("#remindStart").addClass("easyui-datetimebox");$("#remindStart").datetimebox("textbox").attr("maxlength",10);$("#remindEnd").datetimebox({validType:"dateTime",missingMessage:"請輸入提醒時間迄",showSeconds:false});$("#remindEnd").addClass("easyui-datetimebox");$("#remindEnd").datetimebox("textbox").attr("maxlength",10);$("#mailNotice").combobox({editable:false,valueField:"value",textField:"name",data:group,});$("#mailNotice").addClass("easyui-combobox");$("#addEmail_linkbutton").linkbutton({iconCls:"icon-add",});$("#addEmail_linkbutton").addClass("c6");$("#addEmail_linkbutton").bind("click",function(){addEmail()});$("#remoreEmail_linkbutton").linkbutton({iconCls:"icon-edit",});$("#remoreEmail_linkbutton").addClass("c6");$("#remoreEmail_linkbutton").bind("click",function(){remoreEmail(group)});$("#toMail").textbox({required:true,missingMessage:"請輸入收件人",multiline:true});$("#toMail").addClass("easyui-textbox");$("#mailShowFlag").val("Y");$("#jsonmail").val(JSON.stringify(group));var jsonStr={};$("#saveEmailParamer").val(JSON.stringify(jsonStr));$("#remindStart").textbox("setValue","");$("#remindStart").textbox("disable");$("#remindEnd").textbox("setValue","");$("#remindEnd").textbox("disable")}if(actionId==("dispatching")||actionId==("autoDispatching")){$("#nextActivitiToMail").val("被指派的廠商;被指派的廠商部門;被指派的工程師;被指派的角色")}else{if(actionId==("complete")||actionId==("onlineExclusion")||actionId==("immediatelyClosing")){$("#nextActivitiToMail").val("建案之客服")}else{if(actionId==("retreat")){$("#nextActivitiToMail").val("被指派的廠商部門;被指派的工程師")}else{if(actionId==("rushRepair")){$("#nextActivitiToMail").val("被指派的客服;被指派的工程師;被指派的廠商部門")}}}}$("#checkNoticeType").removeClass("div-tips").addClass("div-list").tooltip("destroy");var radio=document.getElementsByName("noticeType");radio[0].checked=true;radio[1].checked=false;$("#remindStart").textbox("setValue","");$("#remindEnd").textbox("setValue","");var nextActivitiToMail=$("#nextActivitiToMail").val();var tempToMail=$("#tempToMail").val();if(tempToMail==""){$("#toMail").textbox("setValue",nextActivitiToMail)}else{$("#toMail").textbox("setValue",tempToMail)}$("#mailNotice").combobox("setValue","");$("#mailNotice").combobox("loadData",group);$("#jsonmail").val(JSON.stringify(group));$("#dlgMail").dialog("open");$("#remindStart").textbox("setValue","");$("#remindStart").textbox("disable");$("#remindEnd").textbox("setValue","");$("#remindEnd").textbox("disable");$("#remindStart").textbox({required:false});$("#remindEnd").textbox({required:false});$("#dialogMsg").text("")}function notice(actionId,datagridId){var mailgroupListString=null;var name=null;var group=null;javascript:dwr.engine.setAsync(false);ajaxService.getMailGroupList(function(data){if(data){group=initSelect(data)}});ajaxService.getNameList(function(data){if(data){name=data}});openMailAction(group,name,actionId,datagridId);javascript:dwr.engine.setAsync(true)}function controlNoticeTime(){$("#dialogMsg").text("");var radio=document.getElementsByName("noticeType");var emailRadio=radio[0];var remindRadio=radio[1];if(remindRadio.checked==true){$("#remindStart").textbox("enable");$("#remindEnd").textbox("enable");$("#remindStart").textbox({required:true});$("#remindEnd").textbox({required:true})}else{$("#remindStart").textbox("setValue","");$("#remindStart").textbox("disable");$("#remindEnd").textbox("setValue","");$("#remindEnd").textbox("disable");$("#remindStart").textbox({required:true});$("#remindEnd").textbox({required:true})}}function addEmail(){$("#dialogMsg").text("");var mailNoticeName=$("#mailNotice").combobox("getText");var mailNoticeValue=$("#mailNotice").combobox("getValue");toMail=$("#toMail").textbox("getValue");if(mailNoticeValue!=""){if(toMail!=""){if(toMail[toMail.length-1]==";"){$("#toMail").textbox("setValue",toMail+mailNoticeName)}else{$("#toMail").textbox("setValue",toMail+";"+mailNoticeName)}}else{$("#toMail").textbox("setValue",mailNoticeName)}var array=[];mailgroupList=JSON.parse($("#jsonmail").val());for(var j=0;j<mailgroupList.length;j++){if(mailgroupList[j].value!=mailNoticeValue){obj=new Object();obj.name=mailgroupList[j].name;obj.value=mailgroupList[j].value;array.push(obj)}}$("#mailNotice").combobox("loadData",array);$("#mailNotice").combobox("setValue","");$("#jsonmail").val(JSON.stringify(array))}}function remoreEmail(mailgroupListString){$("#dialogMsg").text("");$("#toMail").textbox("setValue","");$("#jsonmail").val(JSON.stringify(mailgroupListString));$("#mailNotice").combobox("loadData",mailgroupListString)}function saveEmail(names){$("#dialogMsg").text("");var saveForm=$("#saveForm");var controls=null;var radio=document.getElementsByName("noticeType");var remindRadio=radio[1];if(remindRadio.checked==true){controls=["checkNoticeType","remindStart","remindEnd","toMail"]}else{controls=["checkNoticeType","toMail"]}if(validateForm(controls)&&saveForm.form("validate")){var remindStart=$("#remindStart").textbox("getValue");var remindEnd=$("#remindEnd").textbox("getValue");if(remindStart!=""&&remindEnd!=""){var result=compareTime(remindStart,remindEnd);if(!result){$("#dialogMsg").text("提醒時間起不可大於提醒時間迄");return false}}var toMail=$("#toMail").textbox("getValue");if(toMail.substr(toMail.length-1,toMail.length)==";"){toMail=toMail.substr(0,toMail.length-1)}var toMailName=toMail.split(";");var nameList=JSON.stringify(names);var nameListName=nameList.substr(1,nameList.length-1).split(",");for(var k=0;k<toMailName.length;k++){var isNameList=false;for(var z=0;z<nameListName.length;z++){if(toMailName[k]==$.trim(nameListName[z].replace("[",""))){isNameList=true;break}}if(!isNameList){if($.trim(toMailName[k])!=""){var nextToMail=$("#nextActivitiToMail").val();var nextToMails=nextToMail.split(";");var isNextToMail=false;for(var i=0;i<nextToMails.length;i++){if($.trim(toMailName[k])==nextToMails[i]){isNextToMail=true;break}}if(!isNextToMail){if(!(/^[a-zA-Z0-9_+.-]+\@([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,4}$/i.test($.trim(toMailName[k])))){$("#dialogMsg").text("收件者格式有誤，請重新輸入");return false}}}else{$("#dialogMsg").text("收件者格式有誤，請重新輸入");return false}}}if(toMailName.length>1){var toMailNames=toMail+";";for(var i=0;i<toMailName.length;i++){if(toMailName[i]!=""){if(toMailNames.replace(toMailName[i]+";","").indexOf(toMailName[i]+";")>-1){$("#dialogMsg").text("收件者重複，請重新輸入");return false}}}}var saveParams=getSaveParams();$("#dlgMail").dialog("close");$("#saveEmailParamer").val(JSON.stringify(saveParams));$("#tempToMail").val("");$("#tempToMail").val(toMail)}}function getSaveParams(){var saveForm=$("#saveForm");var saveParams=saveForm.form("getData");return saveParams}function compareTime(remindStart,remindEnd){var startDate=remindStart.split(" ");var closeDate=remindEnd.split(" ");var startTime=startDate[1].split(":");var closeTime=closeDate[1].split(":");var startYear=startDate[0].split("/");var closeYear=closeDate[0].split("/");if(startYear[0]>closeYear[0]){return false}else{if(startYear[0]==closeYear[0]){if(startYear[1]>closeYear[1]){return false}else{if(startYear[1]==closeYear[1]){if(startYear[2]>closeYear[2]){return false}else{if(startYear[2]==closeYear[2]){if(startTime[0]>closeTime[0]){return false}else{if(startTime[0]==closeTime[0]){if(startTime[1]>closeTime[1]){return false}else{return true}}else{return true}}}else{return true}}}else{return true}}}else{return true}}}function showStatusFormatter(value,row,index){if(value=="response"){return"已回應"}else{if(value=="arrive"){return"已到場"}else{if(value=="complete"){return"已完修"}else{return""}}}}function checkTextBox(index,datagridId,actionId){if(actionId=="delay"){addTextLength(index,datagridId,"delayTime",10)}if(actionId=="changeCaseType"){addTextLength(index,datagridId,"expectedCompleteDate",10)}addTextLength(index,datagridId,"description",200);addTextLength(index,datagridId,"dealDate",16)}function addTextLength(index,datagridId,field,length){var description=$("#"+datagridId).datagrid("getEditor",{"index":index,field:field});if(description&&description!=null){$(description.target).textbox("textbox").attr("maxlength",length).bind("blur",function(e){$(description.target).textbox("setValue",$.trim($(this).val()))})}}function actionFormatter(value,row,index){var actionTitle;actionTitle=row.mailInfo;if(actionTitle==null){return value}else{return"<a href='javascript:void(0)' class=\"easyui-tooltip\" title='"+actionTitle+"'>"+value+"</a>"}}function dealSlaSetHourFormatter(value,row,index,hourType){var title;var flag;if(hourType=="response"){if(row.responseCondition!=""){if(row.responseCondition=="OVER_WARNNING"){flag="Y"}else{if(row.responseCondition=="OVER_HOUR"){flag="N"}}title="應回應時間："+transToTimeStamp(row.acceptableResponseDate)+"及已回應時間："+transToTimeStamp(row.responseDate)}}else{if(hourType=="arrive"){if(row.arriveCondition!=""){if(row.arriveCondition=="OVER_WARNNING"){flag="Y"}else{if(row.arriveCondition=="OVER_HOUR"){flag="N"}}title="應到場時間："+transToTimeStamp(row.acceptableArriveDate)+"及已到場時間："+transToTimeStamp(row.arriveDate)}}else{if(hourType=="complete"){if(row.completeCondition!=""){if(row.completeCondition=="OVER_WARNNING"){flag="Y"}else{if(row.completeCondition=="OVER_HOUR"){flag="N"
}}title="應完修時間："+transToTimeStamp(row.acceptableFinishDate)+"及已完修時間："+transToTimeStamp(row.completeDate)}}}}if(flag&&flag=="Y"){return"<a href='javascript:void(0)' class=\"easyui-tooltip\" title="+title+" name='iconWarnning'></a>"}else{if(flag&&flag=="N"){return"<a href='javascript:void(0)' class=\"easyui-tooltip\" title="+title+" name='iconInfo'></a>"}}}function checkAllFun(){var isChecked=true;if($("#allCheckButton").prop("checked")){}else{isChecked=false}var rows=$("#dg").datagrid("getRows");if(rows){var rowsSelect=$("#dg").datagrid("getSelections");var rowsLength=$("#dgResponse").datagrid("getRows").length;if(rowsLength!=0&&rowsSelect&&rowsSelect.length!=0&&isChecked){for(var i=0;i<rows.length;i++){if(rowsSelect[0].caseCategory!=rows[i].caseCategory||rows[i].caseStatus!=rowsSelect[0].caseStatus){$.messager.alert("提示訊息","請選擇同一案件狀態、案件類別的案件","warning");$("#allCheckButton").prop("checked",false);return false}}}for(var i=0;i<rows.length;i++){var index=$("#dg").datagrid("getRowIndex",rows[i]);var obj=$("#dg").closest(".datagrid-wrap").find(".datagrid-view2").find("[datagrid-row-index='"+index+"']").find("input[name='checkBtn']");if(obj.length>0){$(obj).prop("checked",isChecked);if(isChecked){$("#dg").datagrid("selectRow",index)}else{$("#dg").datagrid("collapseRow",$("#dg").datagrid("getRowIndex",rows[i]));$("#dg").datagrid("fixRowHeight",$("#dg").datagrid("getRowIndex",rows[i]));$("#dg").datagrid("unselectRow",index)}}}}}function allCheckButton(){var selectRows=$("#dg").datagrid("getSelections");var checkBtnRow=$("#dg").closest(".datagrid-wrap").find(".datagrid-view2").find("input[name='checkBtn']");if(selectRows.length==checkBtnRow.length){$("#allCheckButton").prop("checked",true)}else{$("#allCheckButton").prop("checked",false)}}function dataGridOnSelect(index,row){var obj=$("#dg").closest(".datagrid-wrap").find(".datagrid-view2").find("[datagrid-row-index='"+index+"']").find("input[name='checkBtn']");if(obj.length>0){obj.prop("checked",true)}else{$("#dg").datagrid("unselectRow",index)}allCheckButton()}function dataGridUnSelect(index,row){var obj=$("#dg").closest(".datagrid-wrap").find(".datagrid-view2").find("[datagrid-row-index='"+index+"']").find("input[name='checkBtn']");if(obj.length>0){obj.prop("checked",false);$("#dg").datagrid("collapseRow",$("#dg").datagrid("getRowIndex",row));$("#dg").datagrid("fixRowHeight",$("#dg").datagrid("getRowIndex",row))}allCheckButton()}function addCaseLogExpand(contextPath){var options=$("#dg").datagrid("options");options.onExpandRow=function(index,row){var queryData={caseId:row.caseId,isHistory:row.isHistory};var addCaseLogOptions={url:contextPath+"/caseHandle.do?actionId=queryTransaction",queryParams:queryData,title:"",nowrap:false,singleSelect:true,rownumbers:true,loadMsg:"",columns:[[{field:"actionName",title:"動作",halign:"center",align:"left",width:120,formatter:function(value,row,index){return actionFormatter(value,row,index)}},{field:"afterActionStatus",title:"動作後狀態",halign:"center",align:"left",width:120},{field:"dealDescription",title:"處理說明",halign:"center",align:"left",width:400,formatter:wrapFormatter},{field:"dealDate",title:"實際執行時間",halign:"center",align:"center",width:170,formatter:formatToTimeStampIgnoreSecond},{field:"createdByName",title:"記錄人員",halign:"center",align:"left",width:120},{field:"mailInfo",title:"mailInfo",halign:"center",align:"left",hidden:true,width:160},{field:"createdDate",title:"記錄日期",halign:"center",align:"center",width:190,formatter:formatToTimeStamp}]],onLoadSuccess:function(data){setTimeout(function(){$.each($("#dg").datagrid("getRows"),function(i,row){$("#dg").datagrid("fixRowHeight",i)})},0);$("#dg").datagrid("fixDetailRowHeight",index)}};var addCaseLogGrid=$("#dg").datagrid("getRowDetail",index).find("table.ddv");var suppliesLinkDatagrid=$("#dg").datagrid("getRowDetail",index).find("table.dataGridSuppliesLink");var suppliesPrev=suppliesLinkDatagrid.closest(".panel").prev();if(suppliesPrev.hasClass("panel")){suppliesLinkDatagrid.closest(".panel").attr("style","display:none;")}addCaseLogGrid.datagrid(addCaseLogOptions);var rows=$("#dg").datagrid("getRows");if(!rows||rows==null||rows.length==0){}else{for(var i=0;i<rows.length;i++){$("#dg").datagrid("fixDetailRowHeight",$("#dg").datagrid("getRowIndex",rows[i]))}}}}function collapseSubView(contextPath){var rows=$("#dg").datagrid("getRows");if(!rows||rows==null||rows.length==0){}else{for(var i=0;i<rows.length;i++){$("#dg").datagrid("collapseRow",$("#dg").datagrid("getRowIndex",rows[i]));$("#dg").datagrid("fixRowHeight",$("#dg").datagrid("getRowIndex",rows[i]))}addCaseLogExpand(contextPath)}}function updateGrid(index,datagridId){$("#"+datagridId).datagrid("updateRow",{index:index,row:{}})}function dgBeforeEdit(index,row){row.editing=true;updateGrid(index,$(this)[0].id)}function dgAfterEdit(index,row){row.editing=false;updateGrid(index,$(this)[0].id)}function dgCancelEdit(index,row){row.editing=false;updateGrid(index,$(this)[0].id)}function checkSign(index,row){var rowsLength=$("#dgResponse").datagrid("getRows").length;if(rowsLength!=0){var rows=$("#dg").datagrid("getSelections");if(rows&&rows.length!=0){var pushRow=true;var tempRow;for(var i=0;i<rows.length;i++){tempRow=rows[i];if(tempRow.caseId==row.caseId){pushRow=false}}if(pushRow){rows.push(row)}}if(rows.length>1){var oneIndex=$("#dg").datagrid("getRowIndex",rows[0]);var i=0;if(oneIndex==index){i=1}if(rows[i].caseCategory!=row.caseCategory||row.caseStatus!=rows[i].caseStatus){$.messager.alert("提示訊息","請選擇同一案件狀態、案件類別的案件","warning");setTimeout(function(){$("#dg").datagrid("uncheckRow",index)},0)}else{if(isSign){setTimeout(function(){$("#dg").datagrid("expandRow",index)},0)}}}}}function showSubView(){var rows=$("#dg").datagrid("getSelections");if(!rows||rows==null||rows.length==0){$.messager.alert("提示訊息","請勾選資料","warning");return false}else{for(var i=0;i<rows.length;i++){$("#dg").datagrid("expandRow",$("#dg").datagrid("getRowIndex",rows[i]))}}}function onUncheck(index,row,contextPath){setTimeout(function(){var rows=$("#dg").datagrid("getSelections");if(rows.length==0){var rowsLength=$("#dgResponse").datagrid("getRows").length;if(rowsLength!=0){deleteAction("dgResponse",contextPath,"response")}}},0)}function deleteAction(datagridId,contextPath,panelId){$("#deleteCaseSuppliesLinkIds").val("");$("#deleteCaseAssetLinkIds").val("");$("#selectSn").val("");var blockStyle={message:"loading...",fadeIn:0,fadeOut:0,css:{width:"150px",top:"40%",left:"40%",height:"50px",border:"3px solid #95B8E7",lineHeight:"50px"},overlayCSS:{backgroundColor:"#aaa",cursor:"default"}};$.blockUI(blockStyle);isSign=false;$("#"+datagridId).datagrid("deleteRow",0);$("#"+panelId).panel("close");editIndex=undefined;collapseSubView(contextPath);$.unblockUI()}function popEditCaseWindows(event,caseId,isHistory,caseStatus,index,contextPath){$("#dgResponse-msg").text("");var clearFlag=true;var rows=$("#dg").datagrid("getSelections");if(rows){var indexArray=[];var tempIndex;for(var i=0;i<rows.length;i++){tempIndex=$("#dg").datagrid("getRowIndex",rows[i]);indexArray.push(tempIndex)}if(indexArray&&(indexArray.length!=0)){for(var j=0;j<indexArray.length;j++){if(indexArray[j]==index){clearFlag=false;break}}}}viewDlg=$("#editDlg").dialog({title:"案件記錄",width:900,height:500,modal:true,method:"post",closed:false,cache:false,queryParams:{actionId:"initEdit",caseId:caseId,isHistory:isHistory},onBeforeLoad:function(){if(viewDlg){viewDlg.panel("clear")}},onLoad:function(){textBoxSetting("editDlg");dateboxSetting("editDlg");mutilComboSelectEvent("editDlg");$("#hidCaseStatus").val(caseStatus);if(viewQueryDtid){viewQueryDtid.panel("clear")}if(viewChooseMid){viewChooseMid.panel("clear")}$("#merchanEditDlg").panel("clear")},onClose:function(){if(clearFlag){$("#dg").datagrid("unselectRow",index)}else{$("#dg").datagrid("selectRow",index)}viewDlg.panel("clear");if(viewQueryDtid){viewQueryDtid.panel("clear")}if(viewChooseMid){viewChooseMid.panel("clear")}$("#merchanEditDlg").panel("clear");$(".qq-uploader-selector").unblock()},href:contextPath+"/caseHandle.do",modal:true});event.stopPropagation();return false}function showEditInfoPage(caseId,contextPath){viewDlgShow=$("#showEditInfo").dialog({title:"案件記錄",width:900,height:500,modal:true,method:"post",closed:false,cache:false,queryParams:{actionId:"showDetailInfo",caseId:caseId,isHistory:"N"},onLoad:function(){if(typeof queryCaseRecordShow!="undefined"&&queryCaseRecordShow instanceof Function){queryCaseRecordShow()}},onClose:function(){if(viewDlgShow){viewDlgShow.dialog("clear")}},href:contextPath+"/caseHandle.do",modal:true})}function btnCancelUpload(){if($("#caseCategory").hasClass("easyui-combobox")){$("#caseCategory").combobox("setValue","")}$(".qq-upload-list-selector").html("");if($("#uploadCaeInfo").hasClass("easyui-panel")){$("#uploadCaeInfo").panel("close")}else{$("#uploadCaeInfo").addClass("easyui-panel");$("#uploadCaeInfo").attr("style","width: 98%; height: auto;");$("#uploadCaeInfo").panel()}$("#assetListMsg").text("")}function showUploadView(){$("#dgResponse-msg").html("");if($("#response").hasClass("easyui-panel")){$("#dgResponse").closest(".easyui-panel").panel("close")}else{$("#response").addClass("easyui-panel");$("#response").attr("style","width: 98%; height: auto;");$("#response").panel();$("#dgResponse").addClass("easyui-datagrid");$("#dgResponse").datagrid();$("#response").children(":first").attr("style","display:none;")}createUploadStyle();if($("#uploadCaeInfo").hasClass("easyui-panel")){$("#uploadCaeInfo").panel("open")}else{$("#uploadCaeInfo").addClass("easyui-panel");$("#uploadCaeInfo").attr("style","width: 98%; height: auto;");$("#uploadCaeInfo").panel();$("#uploadCaeInfo").panel("open")}}function templateDownLoad(contextPath){$("#dgResponse-msg").text("");var controls=["caseCategory"];if(validateForm(controls)&&$("#caseCategoryUpload").form("validate")){var caseCategory=$("#caseCategory").combobox("getValue");createSubmitForm(contextPath+"/caseHandle.do","actionId=exportTemplate&caseCategory="+caseCategory,"post")}}function uploadCaseCategory(id,name){$("#dgResponse-msg").text("");
var controls=["caseCategory"];if(validateForm(controls)&&$("#caseCategoryUpload").form("validate")){var blockStyle={message:"loading...",css:{width:"150px",top:"40%",left:"40%",height:"50px",border:"3px solid #95B8E7",lineHeight:"50px"},overlayCSS:{backgroundColor:"#aaa",cursor:"default"}};if(!(typeof(file_upload_import)=="undefined")&&file_upload_import._storedIds!=""){$.blockUI(blockStyle);if(!(typeof(file_upload_import_Additional)=="undefined")&&file_upload_import_Additional._storedIds!=""){file_upload_import_Additional.uploadStoredFiles()}else{uploadCaseInfo()}}else{$("#dgResponse-msg").text("請輸入要匯入的文件");return false}}}function onAllComplete(succeeded,failed){if(failed){uploadCaseInfo()}else{$.unblockUI();$.messager.alert("提示","保存失敗,請聯繫管理員.","error")}}function uploadCaseInfo(){var caseCategory=$("#caseCategory").combobox("getValue");file_upload_import.setParams({caseCategory:caseCategory,fileName:$("#tempFileName").val()});file_upload_import.uploadStoredFiles()}function filterBlank(){showDataListOInfo();var otherColumn=["checked","src"];dynamicshowColumn("exportBlank","exportList","dg",otherColumn)}function showDataListOInfo(){if($("#showExportListFlag").val()!="Y"){$("#exportList").datalist({checkbox:true,checked:false,singleSelect:false,selectOnCheck:false,toolbar:"#exportToolbarAll",checkOnSelect:true,selectOnCheck:true,idField:"colName",valueField:"colName",textField:"colText",onSelect:function(index,row){dataListOnSelect(row,index,"exportList","exportCheckAll")},onUnselect:function(index,row){dataListUnSelect(row,index,"exportList","exportCheckAll")},onLoadSuccess:function(){datalistSuccessLoad("exportBlank","exportList","exportCheckAll")},data:[{colName:"customerName",colText:"客戶",value:"defaultShow"},{colName:"caseStatusName",colText:"案件狀態",value:"defaultShow"},{colName:"caseTypeName",colText:"案件類型",value:"defaultShow"},{colName:"responseCondition",colText:"回應",value:"defaultShow"},{colName:"arriveCondition",colText:"到場",value:"defaultShow"},{colName:"completeCondition",colText:"完修",value:"defaultShow"},{colName:"responseStatus",colText:"回應狀態"},{colName:"arriveStatus",colText:"到場狀態"},{colName:"completeStatus",colText:"完修狀態"},{colName:"installTypeName",colText:"裝機類型"},{colName:"uninstallTypeName",colText:"拆機類型"},{colName:"caseCategoryName",colText:"案件類別",value:"defaultShow"},{colName:"requirementNo",colText:"需求單號"},{colName:"caseId",colText:"案件編號",value:"defaultShow"},{colName:"contractCode",colText:"案件合約編號"},{colName:"edcTypeContract",colText:"設備合約編號"},{colName:"isProject",colText:"專案"},{colName:"projectCode",colText:"專案代號"},{colName:"projectName",colText:"專案名稱"},{colName:"companyName",colText:"派工廠商",value:"defaultShow"},{colName:"vendorName",colText:"廠商名稱"},{colName:"departmentName",colText:"派工部門"},{colName:"vendorStaff",colText:"廠商人員"},{colName:"sameInstalled",colText:"是否同裝機作業"},{colName:"attendanceTimes",colText:"到場次數",value:"defaultShow"},{colName:"dtid",colText:"DTID",value:"defaultShow"},{colName:"tid",colText:"TID",value:"defaultShow"},{colName:"merchantCode",colText:"特店代號",value:"defaultShow"},{colName:"merchantName",colText:"特店名稱",value:"defaultShow"},{colName:"headerName",colText:"表頭（同對外名稱）",value:"defaultShow"},{colName:"oldMerchantCode",colText:"舊特店代號"},{colName:"areaName",colText:"特店區域"},{colName:"contact",colText:"特店聯絡人"},{colName:"contactTel",colText:"特店聯絡人電話1"},{colName:"contactTel2",colText:"特店聯絡人電話2"},{colName:"phone",colText:"特店聯絡人行動電話"},{colName:"businessHours",colText:"特店營業時間"},{colName:"aoName",colText:"AO人員",value:"defaultShow"},{colName:"aoemail",colText:"AO EMAIL"},{colName:"businessAddress",colText:"特店營業地址"},{colName:"installedAdress",colText:"特店裝機地址"},{colName:"contactAddress",colText:"特店聯繫地址"},{colName:"installedContact",colText:"特店裝機聯絡人"},{colName:"contactUser",colText:"特店聯繫聯絡人"},{colName:"installedContactPhone",colText:"特店裝機電話"},{colName:"contactUserPhone",colText:"特店聯繫聯絡人電話"},{colName:"edcTypeName",colText:"刷卡機型",value:"defaultShow"},{colName:"edcSerialNumber",colText:"設備序號"},{colName:"enableDate",colText:"設備啟用日"},{colName:"wareHouseName",colText:"倉別"},{colName:"openFunctionName",colText:"設備開啟的功能"},{colName:"applicationName",colText:"程式名稱"},{colName:"multiModuleName",colText:"雙模組模式",value:"defaultShow"},{colName:"ecrConnection",colText:"ECR連線"},{colName:"networkLineNumber",colText:"網路線"},{colName:"peripheralsName",colText:"週邊設備1"},{colName:"peripheralsFunctionName",colText:"週邊設備1功能"},{colName:"peripheralsSerialNumber",colText:"週邊設備1序號"},{colName:"peripheralsContract",colText:"週邊設備1合約編號"},{colName:"peripherals2Name",colText:"週邊設備2"},{colName:"peripheralsFunction2Name",colText:"週邊設備2功能"},{colName:"peripherals2SerialNumber",colText:"週邊設備2序號"},{colName:"peripherals2Contract",colText:"週邊設備2合約編號"},{colName:"peripherals3Name",colText:"週邊設備3"},{colName:"peripheralsFunction3Name",colText:"週邊設備3功能"},{colName:"peripherals3SerialNumber",colText:"週邊設備3序號"},{colName:"peripherals3Contract",colText:"週邊設備3合約編號"},{colName:"connectionTypeName",colText:"連線方式"},{colName:"logoStyle",colText:"LOGO"},{colName:"isOpenEncrypt",colText:"是否開啟加密"},{colName:"electronicPayPlatform",colText:"電子化繳費平台"},{colName:"electronicInvoice",colText:"電子發票載具"},{colName:"cupQuickPass",colText:"銀聯閃付"},{colName:"netVendorName",colText:"寬頻連線"},{colName:"localhostIp",colText:"本機IP"},{colName:"netmask",colText:"Netmask"},{colName:"gateway",colText:"Getway"},{colName:"description",colText:"其他說明"},{colName:"merchantCodeOther",colText:"MID2"},{colName:"cupTransType",colText:"CUP交易"},{colName:"dccTransType",colText:"DCC交易"},{colName:"aeMid",colText:"AE-MID"},{colName:"aeTid",colText:"AE-TID"},{colName:"tmsParamDesc",colText:"TMS參數說明"},{colName:"updatedDescription",colText:"異動說明",value:"defaultShow"},{colName:"repairReasonName",colText:"報修原因"},{colName:"problemReasonCategoryName",colText:"報修問題原因分類"},{colName:"problemReasonName",colText:"報修問題原因"},{colName:"problemSolutionCategoryName",colText:"報修解決方式分類"},{colName:"problemSolutionName",colText:"報修解決方式"},{colName:"responsibityName",colText:"是否為責任報修"},{colName:"acceptableResponseDate",colText:"應回應時間"},{colName:"acceptableArriveDate",colText:"應到場時間"},{colName:"acceptableFinishDate",colText:"應完修時間"},{colName:"dispatchUserName",colText:"執行派工人員"},{colName:"dispatchDate",colText:"派工時間"},{colName:"responseUserName",colText:"執行回應人員"},{colName:"responseDate",colText:"回應時間"},{colName:"arriveUserName",colText:"執行到場人員"},{colName:"arriveDate",colText:"到場時間"},{colName:"completeUserName",colText:"執行完修人員"},{colName:"completeDepartmentName",colText:"執行完修部門"},{colName:"completeDate",colText:"完修時間"},{colName:"analyzeUserName",colText:"執行簽收人員"},{colName:"analyzeDate",colText:"簽收時間"},{colName:"closeUserName",colText:"執行結案人員"},{colName:"closeDate",colText:"結案時間"},{colName:"processTypeName",colText:"處理方式"},{colName:"dispatchProcessUsername",colText:"目前處理人",value:"defaultShow"},{colName:"updatedByName",colText:"最後異動人",value:"defaultShow"},{colName:"updatedDate",colText:"最後異動日期",value:"defaultShow"},{colName:"createdByName",colText:"進件人員",value:"defaultShow"},{colName:"createdDate",colText:"進件日期",value:"defaultShow"}],lines:true});$("#showExportListFlag").val("Y")}}function variableExport(){$("#message").empty();var rowLength=getGridRowsCount("dg");var queryCompanyId=$("#queryCompanyId").combobox("getValue");document.getElementById("exportQueryCompanyId").value=queryCompanyId;if(rowLength>=1){var blockStyle={message:"loading...",fadeIn:0,fadeOut:0,css:{width:"150px",top:"40%",left:"40%",height:"50px",border:"3px solid #95B8E7",lineHeight:"50px"},overlayCSS:{backgroundColor:"#aaa",cursor:"default"}};$.blockUI(blockStyle);actionClicked(document.forms["queryForm"],"SRM05020","","variableExport");ajaxService.getExportFlag("SRM05020",function(data){$.unblockUI()})}}var appointmentChange=function(newValue,oldValue){var editorObject=$(this).closest('td[field="caseType"]').siblings('td[field="expectedCompleteDate"]').find("input:text").first();if(newValue=="APPOINTMENT"){var deptCode="";var roleCode="";editorObject.datebox("enable");editorObject.datebox("enableValidation")}else{editorObject.datebox("disable");editorObject.datebox("disableValidation");editorObject.datebox("setValue","")}};function IsQaConfirm(allParams,selectRow){var nextIsQA=true;var isTms=allParams.isTms;var departmentName=allParams.departmentName;if(selectRow.length>0){for(var i=0;i<selectRow.length;i++){if(selectRow[i].isTms=="N"||selectRow[i].departmentName!="TMS"){nextIsQA=false;break}}}else{if(isTms=="N"||departmentName!="TMS"){nextIsQA=false}}return nextIsQA}var selectChange=function(newValue,oldValue){var editorObject=$(this).closest('td[field="dispatchUnit"]').siblings('td[field="dealById"]').find("input:text").first();var selectRow=$("#dg").datagrid("getSelections")[0];if(newValue){var deptCode="";var roleCode="";if(newValue=="CUSTOMER_SERVICE"||newValue=="QA"||newValue=="TMS"){roleCode=newValue}else{deptCode=newValue}ajaxService.getUserByDepartmentAndRole(deptCode,roleCode,false,false,function(result){if(result!=null){if(oldValue){editorObject.combobox("setValue","")}editorObject.combobox("loadData",initSelect(result))}else{editorObject.combobox("loadData",initSelect(null));editorObject.combobox("setValue","")}})}else{editorObject.combobox("loadData",initSelect(null));editorObject.combobox("setValue","")}};function caseAssetLinkFormatter(value,row,index,caseId,assetLinkDatagridID,caseCategory){if(row.isLink=="N"){if(caseCategory!="UNINSTALL"){return"<a href='javascript:void(0)' class='easyui-linkbutton' iconCls:'icon-search'  onclick=\"linkCaseAsset(this,'"+value+"',"+index+",'"+assetLinkDatagridID+"','"+encodeURIComponent(caseId)+"','"+caseCategory+"')\"  name='lbtLink'></a>"}else{return""}}else{if(row.isLink=="Y"){return"<a href='javascript:void(0)' onclick=\"linkCaseAssetName(this,'"+value+"','"+assetLinkDatagridID+"',"+index+",'"+caseCategory+"')\">移除設備</a>"}else{if(row.isLink=="R"){return"<a href='javascript:void(0)' onclick=\"delectCaseAssetName(this,'"+value+"','"+assetLinkDatagridID+"',"+index+",'"+caseCategory+"')\">移除設備</a>"
}}}}function caseAssetLinkActionFormatter(){$(".paymentAsset").combobox({})}function linkCaseAssetName(obj,value,assetLinkDatagridID,index,caseCategory){var index=$(obj).parents("tr[datagrid-row-index]").attr("datagrid-row-index");var rows=$("#"+assetLinkDatagridID).datagrid("getRows");var row=rows[index];var isRepeatLink=row.isRepeatLink;var assetLinkId=row.assetLinkId;var snString=$("#selectSn").val();if(snString.length>0){snString=snString.substring(0,snString.length-1)}var snArray=snString.split(",");var newSn="";for(var k=0;k<snArray.length;k++){if(snArray[k]!=row.serialNumber){newSn=newSn+snArray[k]+","}}if(newSn==","){newSn=""}$("#selectSn").val(newSn);var content;if(isRepeatLink=="Y"){content=$("#"+assetLinkId+"content").textbox("getValue");if($("#"+assetLinkId+assetLinkDatagridID).length>0){if($("#"+assetLinkId+assetLinkDatagridID).combobox("getValue")==""){$("#"+assetLinkId+assetLinkDatagridID).combobox("textbox").focus().trigger("mouseover");return false}}}if(caseCategory!="INSTALL"){$(".textbox-contentLink").textbox();$(".textbox-contentLink").each(function(index,obj){textBoxDefaultSetting($(obj))})}var obj=new Object();if(caseCategory=="UNINSTALL"){obj.action=$("#"+assetLinkId+assetLinkDatagridID).combobox("getValue");obj.content=$("#"+assetLinkId+"content").textbox("getValue")}if(isRepeatLink=="Y"){var actionValue="";actionValue=$("#"+assetLinkId+assetLinkDatagridID).combobox("getValue");$("#"+assetLinkDatagridID).datagrid("updateRow",{index:index,row:{serialNumber:"",isLink:"N",isRepeatLink:"N",actionValue:actionValue,removeContent:content}})}else{$("#"+assetLinkDatagridID).datagrid("updateRow",{index:index,row:{serialNumber:"",isLink:"N",isRepeatLink:"N"}})}$("#"+assetLinkDatagridID).datagrid("beginEdit",index);caseAssetLinkActionFormatter();if($("#"+assetLinkId+assetLinkDatagridID).length>0){$("#"+assetLinkId+assetLinkDatagridID).siblings("span").css("display","none")}if(caseCategory!="INSTALL"){$(".textbox-contentLink").textbox();$(".textbox-contentLink").each(function(index,obj){textBoxDefaultSetting($(obj))});$("#"+assetLinkId+"content").textbox("setValue",obj.content)}$("a[name=lbtLink]").linkbutton({plain:true,iconCls:"icon-search"})}function delectCaseAssetName(obj,value,assetLinkDatagridID,index,caseCategory){var index=$(obj).parents("tr[datagrid-row-index]").attr("datagrid-row-index");var rows=$("#"+assetLinkDatagridID).datagrid("getRows");var row=rows[index];var assetLinkId=row.assetLinkId;var action;var content;if($("#"+assetLinkId+assetLinkDatagridID).length>0){content=$("#"+assetLinkId+"content").textbox("getValue");action=$("#"+assetLinkId+assetLinkDatagridID).combobox("getValue");if($("#"+assetLinkId+assetLinkDatagridID).combobox("getValue")==""){$("#"+assetLinkId+assetLinkDatagridID).combobox("textbox").focus().trigger("mouseover");return false}}if(caseCategory=="INSTALL"||action==null){assetLinkId=assetLinkId+";"+"INSTALL"+";"}else{action=$("#"+assetLinkId+assetLinkDatagridID).combobox("getValue");assetLinkId=assetLinkId+";"+action+";"+content}var deleteCaseAssetLinkIds=$("#deleteCaseAssetLinkIds").val();if(deleteCaseAssetLinkIds!=""){$("#deleteCaseAssetLinkIds").val(deleteCaseAssetLinkIds+","+assetLinkId)}else{$("#deleteCaseAssetLinkIds").val(assetLinkId)}$("#"+assetLinkDatagridID).datagrid("updateRow",{index:index,row:{serialNumber:"",isLink:"D",action:"",content:""}});$("#"+assetLinkDatagridID).datagrid("deleteRow",parseInt(index))}function caseAssetLinkContentFormatter(value,row,index){var assetLinkId=row.assetLinkId;var content=row.content;if(content==null){content=""}return"<input class='textbox-contentLink' id='"+assetLinkId+"content' maxlength='200' value='"+content+"'/>"}function showAssetAndSupplies(){var rows=$("#dg").datagrid("getSelections");for(var i=0;i<rows.length;i++){$("#dg").datagrid("expandRow",$("#dg").datagrid("getRowIndex",rows[i]))}}function getSuppliesTypeList(customerId){javascript:dwr.engine.setAsync(false);ajaxService.getSuppliesListByCustomseId(customerId,function(data){if(data.flag){var suppliesString=data.jsonData;var suppliesObj=jQuery.parseJSON(suppliesString);suppliesTypeList=initSelect(suppliesObj)}});javascript:dwr.engine.setAsync(true);return suppliesTypeList}function getSuppliesNameList(customerId){javascript:dwr.engine.setAsync(false);ajaxService.getSuppliesNameList(customerId,"",function(data){if(data.flag){var suppliesNameString=data.jsonData;var suppliesNameObj=jQuery.parseJSON(suppliesNameString);suppliesNameList=initSelect(suppliesNameObj)}});javascript:dwr.engine.setAsync(true);return suppliesNameList}function onEndEditCaseSuppliesLink(datagridId,indexSupplies,row){var itemIdRow=$(datagridId).datagrid("getEditor",{index:indexSupplies,field:"itemId"});var itemCategoryRow=$(datagridId).datagrid("getEditor",{index:indexSupplies,field:"itemCategory"});row.itemName=$(itemIdRow.target).combobox("getText");row.itemCategoryName=$(itemCategoryRow.target).combobox("getText")}function validateRepairOnlineExclusion(selectRow,problemSolution,dealFlag,caseCategory){var flag="";var ddvRow;if(dealFlag){var rowindexs=[];var rowindex;var caseCategoryVal=selectRow[0].caseCategory;for(var i=0;i<selectRow.length;i++){rowindex=$("#dg").datagrid("getRowIndex",selectRow[i]);rowindexs.push(rowindex)}for(var i=0;i<rowindexs.length;i++){var ddvRows=$("#ddv-"+rowindexs[i]).datagrid("getRows");if(ddvRows.length>0){for(var j=0;j<ddvRows.length;j++){ddvRow=ddvRows[j];if(caseCategoryVal=="REPAIR"&&ddvRow.itemCategory=="EDC"&&(problemSolution=="PROBLEM_SOLUTION_MER-PROVIDE_NEW_EDC"||problemSolution=="PROBLEM_SOLUTION_EDC-CHANGE_EDC")){if(ddvRow.isRepeatLink=="Y"&&ddvRow.uninstallSerialNumber==ddvRow.serialNumber){if(problemSolution=="PROBLEM_SOLUTION_MER-PROVIDE_NEW_EDC"){$.messager.alert("提示訊息","案件編號："+ddvRow.caseId+"，解決方式=特店-提供新刷卡機，請替換設備","warning")}else{$.messager.alert("提示訊息","案件編號："+ddvRow.caseId+"，解決方式=刷卡機-更換刷卡機，請替換設備","warning")}flag="Y";return flag}}}}}}else{var ddvRows=$("#dataGridAssetLink").datagrid("getRows");if(ddvRows.length>0){for(var j=0;j<ddvRows.length;j++){ddvRow=ddvRows[j];if(caseCategory=="REPAIR"&&ddvRow.itemCategory=="EDC"&&(problemSolution=="PROBLEM_SOLUTION_MER-PROVIDE_NEW_EDC"||problemSolution=="PROBLEM_SOLUTION_EDC-CHANGE_EDC")){if(ddvRow.isRepeatLink=="Y"&&ddvRow.uninstallSerialNumber==ddvRow.serialNumber){if(problemSolution=="PROBLEM_SOLUTION_MER-PROVIDE_NEW_EDC"){$.messager.alert("提示訊息","案件編號："+ddvRow.caseId+"，解決方式=特店-提供新刷卡機，請替換設備","warning")}else{$.messager.alert("提示訊息","案件編號："+ddvRow.caseId+"，解決方式=刷卡機-更換刷卡機，請替換設備","warning")}flag="Y";return flag}}}}}return flag}function validatePeripheralsIsComplete(selectRow,row,datagridId){var rowindexs=[];var rowindex;var ddvRow;var caseCategory=selectRow[0].caseCategory;for(var i=0;i<selectRow.length;i++){rowindex=$("#dg").datagrid("getRowIndex",selectRow[i]);rowindexs.push(rowindex)}var flag=false;var caseAssetLinkSerialNumber="";for(var i=0;i<rowindexs.length;i++){var ddvRows=$("#ddv-"+rowindexs[i]).datagrid("getRows");var ddvColumn=$("#ddv-"+rowindexs[i]).datagrid("getColumnFields");var ddvfieldName;var ddvRow;var isRemovePeripherals=false;if(ddvRows.length==0){flag="Y";return flag}for(var j=0;j<ddvRows.length;j++){ddvRow=ddvRows[j];if(ddvRow.itemType!="20"){if(caseCategory=="UNINSTALL"){if(ddvRow.itemType=="10"&&ddvRow.isLink!="N"){$.messager.alert("提示訊息","案件編號："+selectRow[i].caseId+"，請移除連結的設備與週邊設備資料","warning");isRemovePeripherals=true;flag="D";return flag}}}}if(!isRemovePeripherals){for(var j=0;j<ddvRows.length;j++){ddvRow=ddvRows[j];if(ddvRow.itemType!="20"){if(caseCategory=="UNINSTALL"){if((ddvRow.itemType=="11"||ddvRow.itemType=="12"||ddvRow.itemType=="13")&&ddvRow.isLink!="N"){flag=selectRow[i].caseId;return flag}else{flag="Y"}}else{if((ddvRow.itemType=="10"||ddvRow.itemType=="11"||ddvRow.itemType=="12"||ddvRow.itemType=="13")&&(ddvRow.isLink=="N"||ddvRow.isLink=="R")){$.messager.alert("提示訊息","案件編號："+selectRow[i].caseId+"，設備與週邊設備設定不完整","warning");flag="D";return flag}else{flag="Y"}if(ddvRow.itemType=="10"||ddvRow.itemType=="11"||ddvRow.itemType=="12"||ddvRow.itemType=="13"){if(caseAssetLinkSerialNumber.indexOf(ddvRow.serialNumber)>0){$.messager.alert("提示訊息","案件編號："+selectRow[i].caseId+"，設備與週邊設備設備序號："+ddvRow.serialNumber+"已被連結","warning");flag="D";return flag}else{caseAssetLinkSerialNumber=caseAssetLinkSerialNumber+","+ddvRow.serialNumber;flag="Y"}}else{flag="Y"}}if(ddvRow.isLink=="Y"){if($("#"+ddvRow.assetLinkId+"ddv-"+rowindexs[i]).length){var action=$("#"+ddvRow.assetLinkId+"ddv-"+rowindexs[i]).combobox("getValue");if(action!=null&&action!=""){$.messager.alert("提示訊息","案件編號："+selectRow[i].caseId+"，設備與週邊設備未移除連結,不可選擇動作","warning");flag="D";return flag}}}}else{flag="Y"}}}}return flag}function expandAssetLinkDatagrid(isExpandRow,queryData,datagridColums,index,contextPath){var caseAssetLinkOptions={url:contextPath+"/caseHandle.do?actionId=queryCaseAssetLink",queryParams:queryData,title:"設備及週邊設備設定連結",width:900,singleSelect:true,rownumbers:true,loadMsg:"",columns:[datagridColums],onLoadSuccess:function(data){$("a[name=lbtLink]").linkbutton({plain:true,iconCls:"icon-search"});$(".textbox-contentLink").textbox();$(".textbox-contentLink").each(function(index,obj){textBoxDefaultSetting($(obj))});$(".paymentAsset").combobox({});if(isExpandRow){setTimeout(function(){$.each($("#dg").datagrid("getRows"),function(i,row){$("#dg").datagrid("fixRowHeight",i)});$("#dg").datagrid("fixDetailRowHeight",index)},0)}}};if(isExpandRow){caseAssetLinkOptions.onResize=function(){$("#dg").datagrid("fixDetailRowHeight",index)}}return caseAssetLinkOptions}function appendCaseSupplies(datagridId,index,isExpandRow){if($(datagridId).datagrid("getRows").length==0){$(datagridId).datagrid("appendRow",{itemCategory:"",itemId:""});editIndex=$(datagridId).datagrid("getRows").length-1;$(datagridId).datagrid("selectRow",editIndex).datagrid("beginEdit",editIndex);var number=$(datagridId).datagrid("getEditor",{"index":editIndex,field:"number"});$(number.target).textbox("textbox").attr("maxlength",3);var content=$(datagridId).datagrid("getEditor",{"index":editIndex,field:"content"});
$(content.target).textbox("textbox").attr("maxlength",200)}else{if(endEditingCaseSuppliesLink(editIndex,datagridId,isExpandRow)){$(datagridId).datagrid("appendRow",{itemCategory:"",itemId:""});editIndex=$(datagridId).datagrid("getRows").length-1;$(datagridId).datagrid("selectRow",editIndex).datagrid("beginEdit",editIndex);var number=$(datagridId).datagrid("getEditor",{"index":editIndex,field:"number"});$(number.target).textbox("textbox").attr("maxlength",3);var content=$(datagridId).datagrid("getEditor",{"index":editIndex,field:"content"});$(content.target).textbox("textbox").attr("maxlength",200)}}editRows=editIndex;$("#dg").datagrid("fixDetailRowHeight",index)}function validateSuppliesDatagrid(){if(editIndex==undefined){return true}var controls=["itemCategory","itemId","number","content"];if(!validateFormInRow("dataGridSuppliesLink",editIndex,controls)){return false}else{$("div").unbind("scroll.validate");editIndex=undefined;return true}}function endEditingCaseSuppliesLink(editIndex,datagridId,isExpandRow){$("#caseDivId").unbind("scroll.validate");var rows=$(datagridId).datagrid("getRows");var selectRow=$(datagridId).datagrid("getSelections");for(var i=0;i<rows.length;i++){var index=$(datagridId).datagrid("getRowIndex",rows[i]);if(!$(datagridId).datagrid("validateRow",index)){editIndex=index}}if(!isExpandRow){if(!validateSuppliesDatagrid()){return false}}else{var controls=["itemCategory","itemId"];if(!validateFormInRow(datagridId.substring(1,datagridId.length),editIndex,controls)){return false}else{$("div").unbind("scroll.validate")}}var endEditFlag=false;for(var i=0;i<rows.length;i++){var index=$(datagridId).datagrid("getRowIndex",rows[i]);if($(datagridId).datagrid("validateRow",index)){$(datagridId).datagrid("endEdit",parseInt(index));var isSelect=false;for(var j=0;j<selectRow.length;j++){var rowIndex=$(datagridId).datagrid("getRowIndex",selectRow[j]);if(index==rowIndex){isSelect=true}}if((!isSelect)&&index!=editIndex){}endEditFlag=true}else{editIndex=index;endEditFlag=false;break}}if(endEditFlag){editIndex=undefined}return endEditFlag}function saveSignParamerInCaseAction(caseCategory,row,caseId){var ddvRow;var ddvRows=$("#dataGridAssetLink").datagrid("getRows");var ddvColumn=$("#dataGridAssetLink").datagrid("getColumnFields");var ddv2Rows=$("#dataGridSuppliesLink").datagrid("getRows");var ddv2Column=$("#dataGridSuppliesLink").datagrid("getColumnFields");var ddvfieldName;var ddv2fieldName;var ddvparameter;var ddv2parameter;var saveSignParamer=[];for(var i=0;i<ddvRows.length;i++){ddvRow=ddvRows[i];ddvparameter={};var obj=new Object();if(caseCategory!="INSTALL"){obj.content=$("#"+ddvRow.assetLinkId+"content").textbox("getValue");ddvparameter.content=obj.content}if($("#"+ddvRow.assetLinkId).length>0){obj.action=$("#"+ddvRow.assetLinkId).combobox("getValue");ddvparameter.action=obj.action}for(var k=0;k<ddvColumn.length;k++){ddvfieldName=ddvColumn[k];if(ddvfieldName=="serialNumber"){ddvparameter.serialNumber=ddvRow.serialNumber}else{if(ddvfieldName=="itemId"){ddvparameter.itemId=ddvRow.itemId;ddvparameter.itemName=ddvRow.itemName}else{if(ddvfieldName=="itemCategory"){ddvparameter.itemCategory=ddvRow.itemCategory}else{if(ddvfieldName=="isLink"){ddvparameter.isLink=ddvRow.isLink}else{if(ddvfieldName=="warehouseId"){ddvparameter.warehouseId=ddvRow.warehouseId}else{if(ddvfieldName=="contractId"){ddvparameter.contractId=ddvRow.contractId}else{if(ddvfieldName=="uninstallSerialNumber"){ddvparameter.uninstallSerialNumber=ddvRow.uninstallSerialNumber}else{if(ddvfieldName=="propertyId"){ddvparameter.propertyId=ddvRow.propertyId}else{if(ddvfieldName=="actionValue"){ddvparameter.actionValue=ddvRow.actionValue}else{if(ddvfieldName=="removeContent"){ddvparameter.removeContent=ddvRow.removeContent}else{if(ddvfieldName=="isRepeatLink"){ddvparameter.isRepeatLink=ddvRow.isRepeatLink}}}}}}}}}}}ddvparameter.itemType=ddvRow.itemType;ddvparameter.assetLinkId=ddvRow.assetLinkId}ddvparameter.caseId=caseId;saveSignParamer.push(ddvparameter)}if(!validateSuppliesDatagrid()){return false}for(var i=0;i<ddv2Rows.length;i++){if($("#dataGridSuppliesLink").datagrid("validateRow",i)){$("#dataGridSuppliesLink").datagrid("endEdit",i);editIndex=undefined}else{editIndex=i;return false}ddv2Row=ddv2Rows[i];ddv2parameter={};var isFlag=true;if(caseCategory=="INSTALL"){javascript:dwr.engine.setAsync(false);ajaxService.getCaseInfoById(caseId,function(data){if(data){if(data.companyCode=="CHB_EDC"){if("WindowSticker"==ddv2Row.itemCategory){if((ddv2Row.number==""||ddv2Row.number==null)&&($.trim(ddv2Row.content)==""||$.trim(ddv2Row.content)==null)){$.messager.alert("提示訊息","案件編號："+caseId+"，耗材-口窗貼 請輸入數量或說明","warning");isFlag=false;return false}}}}});javascript:dwr.engine.setAsync(false)}if(!isFlag){return false}for(var k=0;k<ddv2Column.length;k++){ddv2fieldName=ddv2Column[k];if(ddv2fieldName=="itemCategory"){ddv2parameter.itemCategory=ddv2Row.itemCategory}else{if(ddv2fieldName=="itemId"){ddv2parameter.itemId=ddv2Row.itemId;ddv2parameter.itemName=ddv2Row.itemName}else{if(ddv2fieldName=="number"){ddv2parameter.number=ddv2Row.number;if(ddv2parameter.number==""){ddv2parameter.number=null}}else{if(ddv2fieldName=="content"){ddv2parameter.content=ddv2Row.content}}}}ddv2parameter.itemType="20";ddv2parameter.assetLinkId=ddv2Row.assetLinkId}ddv2parameter.caseId=caseId;saveSignParamer.push(ddv2parameter)}return saveSignParamer}function saveSignParamer(selectRow,row,datagridId){var rowindexs=[];var caseIds=[];var rowindex;var ddvRow;var caseCategory=selectRow[0].caseCategory;for(var i=0;i<selectRow.length;i++){rowindex=$("#dg").datagrid("getRowIndex",selectRow[i]);rowindexs.push(rowindex);caseIds.push(selectRow[i].caseId)}var ddvAssetLinkParameters=[];for(var i=0;i<rowindexs.length;i++){var caseId=caseIds[i];var ddvRows=$("#ddv-"+rowindexs[i]).datagrid("getRows");var ddvColumn=$("#ddv-"+rowindexs[i]).datagrid("getColumnFields");var ddvfieldName;var ddvparameter;var ddvRow;var ddv2Rows=$("#dataGridSuppliesLink-"+rowindexs[i]).datagrid("getRows");var ddv2Column=$("#dataGridSuppliesLink-"+rowindexs[i]).datagrid("getColumnFields");var ddv2fieldName;var ddv2parameter;var ddv2Row;var controls=["itemCategory","itemId","number","content"];if(editIndex!=undefined){if(!validateFormInRow("dataGridSuppliesLink-"+rowindexs[i],editIndex,controls)){return false}else{$("div").unbind("scroll.validate")}}for(var j=0;j<ddvRows.length;j++){ddvRow=ddvRows[j];ddvparameter={};var obj=new Object();if(caseCategory!="INSTALL"){obj.content=$("#"+ddvRow.assetLinkId+"content").textbox("getValue");ddvparameter.content=obj.content}if($("#"+ddvRow.assetLinkId).length>0){obj.action=$("#"+ddvRow.assetLinkId).combobox("getValue");ddvparameter.action=obj.action}for(var k=0;k<ddvColumn.length;k++){ddvfieldName=ddvColumn[k];if(ddvfieldName=="serialNumber"){ddvparameter.serialNumber=ddvRow.serialNumber}else{if(ddvfieldName=="itemId"){ddvparameter.itemId=ddvRow.itemId;ddvparameter.itemName=ddvRow.itemName}else{if(ddvfieldName=="itemCategory"){ddvparameter.itemCategory=ddvRow.itemCategory}else{if(ddvfieldName=="isLink"){ddvparameter.isLink=ddvRow.isLink}else{if(ddvfieldName=="warehouseId"){ddvparameter.warehouseId=ddvRow.warehouseId}else{if(ddvfieldName=="contractId"){ddvparameter.contractId=ddvRow.contractId}else{if(ddvfieldName=="uninstallSerialNumber"){ddvparameter.uninstallSerialNumber=ddvRow.uninstallSerialNumber}else{if(ddvfieldName=="propertyId"){ddvparameter.propertyId=ddvRow.propertyId}else{if(ddvfieldName=="actionValue"){ddvparameter.actionValue=ddvRow.actionValue}else{if(ddvfieldName=="removeContent"){ddvparameter.removeContent=ddvRow.removeContent}else{if(ddvfieldName=="isRepeatLink"){ddvparameter.isRepeatLink=ddvRow.isRepeatLink}}}}}}}}}}}ddvparameter.itemType=ddvRow.itemType;ddvparameter.assetLinkId=ddvRow.assetLinkId}ddvparameter.caseId=caseId;ddvAssetLinkParameters.push(ddvparameter)}for(var j=0;j<ddv2Rows.length;j++){ddv2Row=ddv2Rows[j];ddv2parameter={};if($("#dataGridSuppliesLink-"+rowindexs[i]).datagrid("validateRow",j)){$("#dataGridSuppliesLink-"+rowindexs[i]).datagrid("endEdit",j)}else{editIndex=j;return false}var isFlag=true;if(caseCategory=="INSTALL"){javascript:dwr.engine.setAsync(false);ajaxService.getCaseInfoById(caseId,function(data){if(data){if(data.companyCode=="CHB_EDC"){if("WindowSticker"==ddv2Row.itemCategory){if((ddv2Row.number==""||ddv2Row.number==null)&&($.trim(ddv2Row.content)==""||$.trim(ddv2Row.content)==null)){$.messager.alert("提示訊息","案件編號："+caseId+"，耗材-口窗貼 請輸入數量或說明","warning");isFlag=false;return false}}}}});javascript:dwr.engine.setAsync(true)}if(!isFlag){editIndex=j;return false}for(var k=0;k<ddv2Column.length;k++){ddv2fieldName=ddv2Column[k];if(ddv2fieldName=="itemCategory"){ddv2parameter.itemCategory=ddv2Row.itemCategory}else{if(ddv2fieldName=="itemId"){ddv2parameter.itemId=ddv2Row.itemId;ddv2parameter.itemName=ddv2Row.itemName}else{if(ddv2fieldName=="number"){ddv2parameter.number=ddv2Row.number;if(ddv2parameter.number==""){ddv2parameter.number=null}}else{if(ddv2fieldName=="content"){ddv2parameter.content=ddv2Row.content}}}}ddv2parameter.itemType="20";ddv2parameter.assetLinkId=ddv2Row.assetLinkId}ddv2parameter.caseId=caseId;ddvAssetLinkParameters.push(ddv2parameter)}}editIndex=undefined;return ddvAssetLinkParameters}function validatePeripheralsIsCompleteInCaseAction(caseCategory,row,caseId){var ddvRow;var flag=false;var ddvRows=$("#dataGridAssetLink").datagrid("getRows");var ddvColumn=$("#dataGridAssetLink").datagrid("getColumnFields");var ddvfieldName;var ddvRow;var isRemovePeripherals=false;if(ddvRows.length==0){flag="Y";return flag}for(var j=0;j<ddvRows.length;j++){ddvRow=ddvRows[j];if(ddvRow.itemType!="20"){if(caseCategory=="UNINSTALL"){if(ddvRow.itemType=="10"&&ddvRow.isLink!="N"){$.messager.alert("提示訊息","案件編號："+caseId+"，請移除連結的設備與週邊設備資料","warning");isRemovePeripherals=true;flag="D";return flag}}}}if(!isRemovePeripherals){for(var j=0;j<ddvRows.length;j++){ddvRow=ddvRows[j];if(ddvRow.itemType!="20"){if(caseCategory=="UNINSTALL"){if((ddvRow.itemType=="11"||ddvRow.itemType=="12"||ddvRow.itemType=="13")&&ddvRow.isLink!="N"){flag=caseId;
return flag}else{flag="Y"}}else{if((ddvRow.itemType=="10"||ddvRow.itemType=="11"||ddvRow.itemType=="12"||ddvRow.itemType=="13")&&(ddvRow.isLink=="N"||ddvRow.isLink=="R")){$.messager.alert("提示訊息","案件編號："+caseId+"，設備與週邊設備設定不完整","warning");flag="D";return flag}else{flag="Y"}}if(ddvRow.isLink=="Y"){if($("#"+ddvRow.assetLinkId+"dataGridAssetLink").length>0){var action=$("#"+ddvRow.assetLinkId+"dataGridAssetLink").combobox("getValue");if(action!=null&&action!=""){$.messager.alert("提示訊息","案件編號："+caseId+"，設備與週邊設備未移除連結,不可選擇動作","warning");flag="D";return flag}}}}else{flag="Y"}}}return flag}function removeCaseSuppliesLink(datagridId,index){var row=$(datagridId).datagrid("getSelections");var flag=false;var count=0;if(row.length>0){for(var i=0;i<row.length;i++){if(row[i].assetLinkId!=""){var deleteCaseSuppliesLinkIds=$("#deleteCaseSuppliesLinkIds").val();if(deleteCaseSuppliesLinkIds!=""){$("#deleteCaseSuppliesLinkIds").val(deleteCaseSuppliesLinkIds+","+row[i].assetLinkId)}else{$("#deleteCaseSuppliesLinkIds").val(row[i].assetLinkId)}}var rowIndex=$(datagridId).datagrid("getRowIndex",row[i]);if(editIndex!=undefined){if(editIndex==rowIndex){flag=true}if(editIndex>rowIndex){count++}}$(datagridId).datagrid("deleteRow",rowIndex)}}else{$.messager.alert("提示訊息","請選擇耗材","warning");return false}if(flag){editIndex=undefined}else{if(editIndex!=undefined){editIndex=editIndex-count}}editRows=editIndex;$("#dg").datagrid("fixDetailRowHeight",index)}var assetContentOnChange=function(newValue,oldValue,suppliesLinkDatagridId){editRows=editIndex;var number=$(suppliesLinkDatagridId).datagrid("getEditor",{"index":editRows,field:"number"});var content=$(suppliesLinkDatagridId).datagrid("getEditor",{"index":editRows,field:"content"});var contentValue11=$(content.target).textbox("getValue");if(contentValue11){var realContentValue=$.trim(contentValue11);$(content.target).textbox("setValue",realContentValue)}var numberValue=$(number.target).textbox("getValue");var contentValue=$(content.target).textbox("getValue");var options=$(content.target).textbox("options");if(!options.required){if(contentValue==""||contentValue==null){if(numberValue==""||numberValue==null){$(content.target).textbox("setValue","");$(content.target).textbox({required:true})}}}};function onDblClickCellCaseSuppliesLink(datagridId,indexSupplies,field,value,isExpandRow){$("#caseDivId").unbind("scroll.validate");var selectRow=$(datagridId).datagrid("getSelections");if(endEditingCaseSuppliesLink(editIndex,datagridId,isExpandRow)){editIndex=indexSupplies;editRows=indexSupplies;$(datagridId).datagrid("selectRow",indexSupplies).datagrid("beginEdit",indexSupplies);var itemCategory=$(datagridId).datagrid("getEditor",{"index":indexSupplies,field:"itemCategory"});var itemId=$(datagridId).datagrid("getEditor",{"index":indexSupplies,field:"itemId"});var number=$(datagridId).datagrid("getEditor",{"index":indexSupplies,field:"number"});$(number.target).textbox("textbox").attr("maxlength",3);$(number.target).textbox("textbox").attr("maxlength",3).bind("blur",function(e){$(number.target).textbox("setValue",$.trim($(this).val()))});var content=$(datagridId).datagrid("getEditor",{"index":indexSupplies,field:"content"});$(content.target).textbox("textbox").attr("maxlength",200);$(content.target).textbox("textbox").attr("maxlength",200).bind("blur",function(e){$(content.target).textbox("setValue",$.trim($(this).val()))})}else{$(datagridId).datagrid("selectRow",editIndex)}var isSelect=false;for(var j=0;j<selectRow.length;j++){var rowIndex=$(datagridId).datagrid("getRowIndex",selectRow[j]);if(rowIndex==editIndex){isSelect=true}}if(!isSelect){}}var assetNumberOnChange=function(newValue,oldValue,suppliesLinkDatagridId){editRows=editIndex;var number=$(suppliesLinkDatagridId).datagrid("getEditor",{"index":editRows,field:"number"});var content=$(suppliesLinkDatagridId).datagrid("getEditor",{"index":editRows,field:"content"});var numberValue=$(number.target).textbox("getValue");var contentValue=$(content.target).textbox("getValue");if(numberValue==""||numberValue==null){$(content.target).textbox({required:true})}else{if(contentValue==""||contentValue==null){$(content.target).textbox("setValue","")}$(content.target).textbox({required:false})}$(content.target).textbox("textbox").attr("maxlength",200)};function suppliesTypeOnChange(newValue,oldValue,customerId,suppliesLinkDatagridId){var rows=$(suppliesLinkDatagridId).datagrid("getRows");var row=rows[editIndex];var number=$(suppliesLinkDatagridId).datagrid("getEditor",{"index":editRows,field:"number"});var content=$(suppliesLinkDatagridId).datagrid("getEditor",{"index":editRows,field:"content"});var numberValue=$(number.target).textbox("getValue");var contentValue=$(content.target).textbox("getValue");var itemCategory=$(suppliesLinkDatagridId).datagrid("getEditor",{"index":editIndex,field:"itemCategory"});var itemCategoryValue=$(itemCategory.target).combobox("getValue");var itemId=$(suppliesLinkDatagridId).datagrid("getEditor",{"index":editIndex,field:"itemId"});var itemIdValue=$(itemId.target).combobox("getValue");if(newValue!=""){ajaxService.getSuppliesNameList(customerId,$(itemCategory.target).combobox("getValue"),function(data){if(data.flag){var suppliesName=data.jsonData;var suppliesNameObj=jQuery.parseJSON(suppliesName);var result=suppliesNameObj;suppliesNameList=initSelect(suppliesNameObj);for(var i=0;i<rows.length;i++){if(i==editIndex){continue}if(rows[i].itemCategory==newValue){for(var j=0;j<result.length;j++){if(result[j].value==rows[i].itemId){result.splice(j,1);break}}}}var currentEditor=$(suppliesLinkDatagridId).datagrid("getEditor",{index:editIndex,field:"itemId"});var currentValue=currentEditor.target.combobox("getValue");if(result.length>0&&row.itemCategory==newValue){currentEditor.target.combobox("setValue",currentValue)}else{currentEditor.target.combobox("setValue","")}currentEditor.target.combobox("loadData",suppliesNameList)}})}else{var currentEditor=$(suppliesLinkDatagridId).datagrid("getEditor",{index:editIndex,field:"itemId"});currentEditor.target.combobox("setValue","");currentEditor.target.combobox("loadData",initSelect(null))}}function addSuppliesLinkColumns(customerId,suppliesLinkDatagridId){var columns=[];var suppliesTypeList=getSuppliesTypeList(customerId);var suppliesNameList=getSuppliesNameList(customerId);columns=[{field:"itemCategory",title:"耗材分類",width:140,halign:"center",formatter:function(value,row){return row.itemCategoryName},editor:{type:"combobox",options:{valueField:"value",textField:"name",editable:false,invalidMessage:"請輸入耗材分類",data:suppliesTypeList,panelHeight:"auto",onChange:function(newValue,oldValue){suppliesTypeOnChange(newValue,oldValue,customerId,suppliesLinkDatagridId)},required:true,validType:["requiredDropList"]}}},{field:"itemId",title:"耗材名稱",width:140,halign:"center",halign:"center",formatter:function(value,row){return row.itemName},editor:{type:"combobox",options:{valueField:"value",textField:"name",editable:false,invalidMessage:"請輸入耗材名稱",data:suppliesNameList,required:true,validType:["requiredDropList"]}}},{field:"number",title:"數量",width:100,halign:"center",editor:{type:"textbox",options:{required:false,missingMessage:"請輸入數量",validType:["number['數量限正整數，請重新輸入']","maxLength[3]"]}}},{field:"content",title:"說明",width:240,halign:"center",editor:{type:"textbox",options:{required:false,missingMessage:"請輸入說明",validType:["maxLength[200]"]}}},{field:"assetLinkId",title:"ID",width:300,hidden:true,editor:"textbox"},{field:"itemType",title:"類別",width:300,hidden:true,editor:"textbox"},{field:"propertyId",title:"財產編號",width:300,hidden:true,editor:"textbox"}];return columns}function onClickRow(datagridId,indexSupplies,field,value){if(editIndex==undefined){$(datagridId).datagrid("selectRow",indexSupplies)}else{$(datagridId).datagrid("selectRow",editIndex)}}function expandSuppliesLinkDatagrid(querySuppliesData,datagridId,isExpandRow,customerId,index,contextPath){var suppliesColumns=[];suppliesColumns=addSuppliesLinkColumns(customerId,datagridId);var caseSuppliesLinkOptions={url:contextPath+"/caseHandle.do?actionId=queryCaseSuppliesLink",queryParams:querySuppliesData,title:"耗材設定連結",width:900,singleSelect:true,selectOnCheck:true,rownumbers:true,loadMsg:"",onDblClickCell:function(indexSupplies,field,value){onDblClickCellCaseSuppliesLink(datagridId,indexSupplies,field,value,isExpandRow)},onClickRow:function(indexSupplies,field,value){onClickRow(datagridId,indexSupplies,field,value)},toolbar:[{iconCls:"icon-add",handler:function(){appendCaseSupplies(datagridId,index,isExpandRow)}},"-",{iconCls:"icon-remove",handler:function(){removeCaseSuppliesLink(datagridId,index)}}],columns:[suppliesColumns],onLoadSuccess:function(data){if(isExpandRow){setTimeout(function(){$.each($("#dg").datagrid("getRows"),function(i,row){$("#dg").datagrid("fixRowHeight",i)});$("#dg").datagrid("fixDetailRowHeight",index)},0)}}};if(isExpandRow){caseSuppliesLinkOptions.onResize=function(){$("#dg").datagrid("fixDetailRowHeight",index)}}caseSuppliesLinkOptions.onEndEdit=function(indexSupplies,row){onEndEditCaseSuppliesLink(datagridId,indexSupplies,row)};return caseSuppliesLinkOptions}function getAllColumnOptions(){var allColumnOptions=[{field:"customerName",width:180,sortable:true,halign:"center",align:"left",title:"客戶"},{field:"caseStatusName",width:90,sortable:true,halign:"center",align:"left",title:"案件狀態"},{field:"caseTypeName",width:100,sortable:true,halign:"center",align:"left",title:"案件類型"},{field:"responseCondition",width:50,halign:"center",align:"center",formatter:function(value,row,index){return dealSlaSetHourFormatter(value,row,index,"response")},title:"回應"},{field:"arriveCondition",width:50,halign:"center",align:"center",formatter:function(value,row,index){return dealSlaSetHourFormatter(value,row,index,"arrive")},title:"到場"},{field:"completeCondition",width:50,halign:"center",align:"center",formatter:function(value,row,index){return dealSlaSetHourFormatter(value,row,index,"complete")},title:"完修"},{field:"responseStatus",width:80,sortable:true,halign:"center",align:"left",formatter:showStatusFormatter,hidden:true,title:"回應狀態"},{field:"arriveStatus",width:80,sortable:true,halign:"center",align:"left",formatter:showStatusFormatter,hidden:true,title:"到場狀態"},{field:"completeStatus",width:80,sortable:true,halign:"center",align:"left",formatter:showStatusFormatter,hidden:true,title:"完修狀態"},{field:"installTypeName",width:120,sortable:true,halign:"center",align:"left",hidden:true,title:"裝機類型"},{field:"uninstallTypeName",width:120,sortable:true,halign:"center",align:"left",hidden:true,title:"拆機類型"},{field:"caseCategoryName",width:80,sortable:true,halign:"center",align:"left",title:"案件類別"},{field:"requirementNo",width:160,sortable:true,halign:"center",align:"left",hidden:true,title:"需求單號"},{field:"caseId",width:180,sortable:true,halign:"center",align:"left",title:"案件編號"},{field:"contractCode",width:150,sortable:true,halign:"center",align:"left",hidden:true,title:"案件合約編號"},{field:"edcTypeContract",width:150,sortable:true,halign:"center",align:"left",hidden:true,title:"設備合約編號"},{field:"isProject",width:60,sortable:true,halign:"center",align:"left",formatter:fomatterYesOrNo,hidden:true,title:"專案"},{field:"projectCode",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"專案代號"},{field:"projectName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"專案名稱"},{field:"companyName",width:240,sortable:true,halign:"center",align:"left",title:"派工廠商"},{field:"vendorName",width:150,sortable:true,halign:"center",align:"left",hidden:true,title:"廠商名稱"},{field:"departmentName",width:150,sortable:true,halign:"center",align:"left",hidden:true,title:"派工部門"},{field:"vendorStaff",width:150,sortable:true,halign:"center",align:"left",hidden:true,title:"廠商人員"},{field:"sameInstalled",width:140,sortable:true,halign:"center",align:"left",formatter:fomatterYesOrNo,hidden:true,title:"是否同裝機作業"},{field:"attendanceTimes",width:90,sortable:true,halign:"center",align:"right",title:"到場次數"},{field:"dtid",width:120,sortable:true,halign:"center",align:"left",title:"DTID"},{field:"tid",width:120,sortable:true,halign:"center",align:"left",title:"TID"},{field:"merchantCode",width:140,sortable:true,halign:"center",align:"left",title:"特店代號"},{field:"merchantName",width:160,sortable:true,halign:"center",align:"left",title:"特店名稱"},{field:"headerName",width:160,sortable:true,halign:"center",align:"left",title:"表頭（同對外名稱）"},{field:"oldMerchantCode",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"舊特店代號"},{field:"areaName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"特店區域"},{field:"contact",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"特店聯絡人"},{field:"contactTel",width:180,sortable:true,halign:"center",align:"left",hidden:true,title:"特店聯絡人電話1"},{field:"contactTel2",width:180,sortable:true,halign:"center",align:"left",hidden:true,title:"特店聯絡人電話2"},{field:"phone",width:180,sortable:true,halign:"center",align:"left",hidden:true,title:"特店聯絡人行動電話"},{field:"businessHours",width:120,sortable:true,halign:"center",align:"left",hidden:true,title:"特店營業時間"},{field:"aoName",width:90,sortable:true,halign:"center",align:"left",title:"AO人員"},{field:"aoemail",width:260,sortable:true,halign:"center",align:"left",hidden:true,title:"AO EMAIL"},{field:"caseArea",width:250,sortable:true,halign:"center",align:"left",hidden:true,title:"案件區域"},{field:"businessAddress",width:250,sortable:true,halign:"center",align:"left",hidden:true,title:"特店營業地址"},{field:"installedAdress",width:250,sortable:true,halign:"center",align:"left",hidden:true,title:"特店裝機地址"},{field:"contactAddress",width:250,sortable:true,halign:"center",align:"left",hidden:true,title:"特店聯繫地址"},{field:"installedContact",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"特店裝機聯絡人"},{field:"contactUser",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"特店聯繫聯絡人"},{field:"installedContactPhone",width:160,sortable:true,halign:"center",align:"left",hidden:true,title:"特店裝機電話"},{field:"contactUserPhone",width:170,sortable:true,halign:"center",align:"left",hidden:true,title:"特店聯繫聯絡人電話"},{field:"edcTypeName",width:140,sortable:true,halign:"center",align:"left",title:"刷卡機型"},{field:"edcSerialNumber",width:170,sortable:true,halign:"center",align:"left",hidden:true,title:"設備序號"},{field:"enableDate",width:130,sortable:true,halign:"center",align:"center",formatter:formaterTimeStampToyyyyMMDD,hidden:true,title:"設備啟用日"},{field:"wareHouseName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"倉別"},{field:"openFunctionName",width:190,sortable:true,halign:"center",align:"left",hidden:true,title:"設備開啟的功能"},{field:"applicationName",width:220,sortable:true,halign:"center",align:"left",hidden:true,title:"程式名稱"},{field:"multiModuleName",width:140,sortable:true,halign:"center",align:"left",title:"雙模組模式"},{field:"ecrConnection",width:90,sortable:true,halign:"center",align:"left",hidden:true,formatter:ecrConnectionFormatter,title:"ECR連線"},{field:"networkLineNumber",width:120,sortable:true,halign:"center",align:"left",hidden:true,title:"網路線"},{field:"peripheralsName",width:130,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備1"},{field:"peripheralsFunctionName",width:190,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備1功能"},{field:"peripheralsSerialNumber",width:170,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備1序號"},{field:"peripheralsContract",width:180,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備1合約編號"},{field:"peripherals2Name",width:130,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備2"},{field:"peripheralsFunction2Name",width:190,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備2功能"},{field:"peripherals2SerialNumber",width:170,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備2序號"},{field:"peripherals2Contract",width:180,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備2合約編號"},{field:"peripherals3Name",width:130,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備3"},{field:"peripheralsFunction3Name",width:190,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備3功能"},{field:"peripherals3SerialNumber",width:170,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備3序號"},{field:"peripherals3Contract",width:180,sortable:true,halign:"center",align:"left",hidden:true,title:"週邊設備3合約編號"},{field:"connectionTypeName",width:170,sortable:true,halign:"center",align:"left",hidden:true,title:"連線方式"},{field:"logoStyle",width:150,sortable:true,halign:"center",align:"left",formatter:fomatterLogoStyle,hidden:true,title:"LOGO"},{field:"isOpenEncrypt",width:150,sortable:true,halign:"center",align:"left",formatter:fomatterYesOrNo,hidden:true,title:"是否開啟加密"},{field:"electronicPayPlatform",width:150,sortable:true,halign:"center",align:"left",formatter:fomatterYesOrNo,hidden:true,title:"電子化繳費平台"},{field:"electronicInvoice",width:150,sortable:true,halign:"center",align:"left",formatter:fomatterYesOrNo,hidden:true,title:"電子發票載具"},{field:"cupQuickPass",width:100,sortable:true,halign:"center",align:"left",formatter:fomatterYesOrNo,hidden:true,title:"銀聯閃付"},{field:"netVendorName",width:110,sortable:true,halign:"center",align:"left",hidden:true,title:"寬頻連線"},{field:"localhostIp",width:130,sortable:true,halign:"center",align:"left",hidden:true,title:"本機IP"},{field:"netmask",width:130,sortable:true,halign:"center",align:"left",hidden:true,title:"Netmask"},{field:"gateway",width:130,sortable:true,halign:"center",align:"left",hidden:true,title:"Getway"},{field:"description",width:260,sortable:true,halign:"center",align:"left",hidden:true,title:"其他說明"},{field:"merchantCodeOther",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"MID2"},{field:"cupTransType",width:90,sortable:true,halign:"center",align:"left",hidden:true,title:"CUP交易"},{field:"dccTransType",width:90,sortable:true,halign:"center",align:"left",hidden:true,title:"DCC交易"},{field:"aeMid",width:110,sortable:true,halign:"center",align:"left",hidden:true,title:"AE-MID"},{field:"aeTid",width:110,sortable:true,halign:"center",align:"left",hidden:true,title:"AE-TID"},{field:"tmsParamDesc",width:260,sortable:true,halign:"center",align:"left",hidden:true,title:"TMS參數說明"},{field:"updatedDescription",width:360,sortable:false,halign:"center",align:"left",title:"異動說明"},{field:"repairReasonName",width:240,sortable:true,halign:"center",align:"left",hidden:true,title:"報修原因"},{field:"problemReasonCategoryName",width:160,sortable:true,halign:"center",align:"left",hidden:true,title:"報修問題原因分類"},{field:"problemReasonName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"報修問題原因"},{field:"problemSolutionCategoryName",width:160,sortable:true,halign:"center",align:"left",hidden:true,title:"報修解決方式分類"},{field:"problemSolutionName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"報修解決方式"},{field:"responsibityName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"是否為責任報修"},{field:"acceptableResponseDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,hidden:true,title:"應回應時間"},{field:"acceptableArriveDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,hidden:true,title:"應到場時間"},{field:"acceptableFinishDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,hidden:true,title:"應完修時間"},{field:"dispatchUserName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"執行派工人員"},{field:"dispatchDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,hidden:true,title:"派工時間"},{field:"responseUserName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"執行回應人員"},{field:"responseDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,hidden:true,title:"回應時間"},{field:"arriveUserName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"執行到場人員"},{field:"arriveDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,hidden:true,title:"到場時間"},{field:"completeUserName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"執行完修人員"},{field:"completeDepartmentName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"執行完修部門"},{field:"completeDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,hidden:true,title:"完修時間"},{field:"analyzeUserName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"執行簽收人員"},{field:"analyzeDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,hidden:true,title:"簽收時間"},{field:"closeUserName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"執行結案人員"},{field:"closeDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,hidden:true,title:"結案時間"},{field:"processTypeName",width:140,sortable:true,halign:"center",align:"left",hidden:true,title:"處理方式"},{field:"dispatchProcessUsername",width:140,sortable:true,halign:"center",align:"left",title:"目前處理人"},{field:"updatedByName",width:140,sortable:true,halign:"center",align:"left",title:"最後異動人"},{field:"updatedDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,title:"最後異動日期"},{field:"createdByName",width:140,sortable:true,halign:"center",align:"left",title:"進件人員"},{field:"createdDate",width:190,sortable:true,halign:"center",align:"center",formatter:formatToTimeStamp,title:"進件日期"},{field:"firstDescription",width:360,sortable:false,halign:"center",align:"left",title:"最近第一次記錄",formatter:wrapFormatter},{field:"secondDescription",width:360,sortable:false,halign:"center",align:"left",title:"最近第二次記錄",formatter:wrapFormatter},{field:"thirdDescription",width:360,sortable:false,halign:"center",align:"left",title:"最近第三次記錄",formatter:wrapFormatter}];
return allColumnOptions};